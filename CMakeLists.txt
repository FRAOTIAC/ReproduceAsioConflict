cmake_minimum_required(VERSION 3.12)
project(ReproduceAsioConflict)

set(CMAKE_CXX_STANDARD 17)
find_package(Protobuf REQUIRED)
find_package(Boost COMPONENTS system)
find_package(yaml-cpp REQUIRED)
find_package(OpenSSL REQUIRED)
find_package(ZLIB)

link_directories(/usr/local/lib)

find_package(PkgConfig REQUIRED)
pkg_check_modules(glog REQUIRED libglog)
include_directories(${glog_INCLUDE_DIRS})
message(STATUS "glog include dir: ${glog_INCLUDE_DIRS}, lib dir: ${glog_LIBRARY_DIRS}, libs: ${glog_LIBRARIES}")

add_definitions(-DASIO_STANDALONE)

add_subdirectory(ws-protocol)
set(FOXGLOVE_PROTO_HEADER_DIR ${CMAKE_BINARY_DIR}/ws-protocol/cpp/examples/autogenerated_protobuf/ CACHE PATH "foxglove ws-proto header path" FORCE)
message(STATUS "foxglove ws-proto header path: ${FOXGLOVE_PROTO_HEADER_DIR}")

include_directories(
        include
        ${FOXGLOVE_PROTO_HEADER_DIR}
        ${CMAKE_SOURCE_DIR}/ws-protocol/websocketpp
        ${CMAKE_SOURCE_DIR}/ws-protocol/cpp/foxglove-websocket/include/
)
add_executable(asio_conflict_test reader.cpp)
target_link_libraries(asio_conflict_test
        cyber
        foxglove_websocket
        foxglove_proto
        ${Boost_LIBRARIES}
        ${PROTOBUF_LIBRARY}
        ${glog_LIBRARIES}
        gflags
        pthread
        OpenSSL::SSL
        OpenSSL::Crypto
        ZLIB::ZLIB
)

add_executable(writer writer.cpp)
target_link_libraries(writer
        cyber
        fastrtps
        foxglove_proto
        ${Boost_LIBRARIES}
        ${PROTOBUF_LIBRARY}
        ${glog_LIBRARIES}
        gflags
        pthread
        OpenSSL::SSL
        OpenSSL::Crypto
        ZLIB::ZLIB
)